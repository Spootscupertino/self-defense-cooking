<!-- refactor: external css/js -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Recipe Template</title>
  <meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate, max-age=0">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <link rel="stylesheet" href="assets/style.css?v=20251226-2">
  <script>
    window.__RECIPE_ENGINE_BUILD__ = {
      entrypoint: "self-defense-cooking/index.html",
      sourceFile: "/Users/ericeldridge/Desktop/recipe-engine/self-defense-cooking/index.html",
      repo: { name: "self-defense-cooking", commit: "f4fb2ae" },
      parentRepo: { name: "recipe-engine", commit: "219953c" }
    };
  </script>
</head>
<body>
  <div class="overlay">
    <div class="container">
      <header class="topbar">
        <div class="brand">
          <h1>Recipe Name</h1>
          <p class="subtitle" id="servingsLabel">Yield: 4 portions</p>
          <div class="allergen-summary" id="allergenSummary" aria-live="polite"></div>
          <div class="recipe-status" id="recipeStatus" aria-live="polite"></div>
        </div>
        <div class="search-card">
          <label for="recipeSearch">Find a recipe</label>
          <input id="recipeSearch" type="search" placeholder="Search recipes..." autocomplete="off" />
          <ul id="searchResults" class="search-results" hidden></ul>
        </div>
        <div class="category-board">
          <div class="category-head">
            <span class="category-title">Browse by category</span>
            <span class="category-hint">Tap a category to see the top 25 dishes</span>
          </div>
          <div class="category-chips" id="categoryChips"></div>
          <ul class="category-picks" id="categoryPicks"></ul>
        </div>
        <section id="recipeBrowse" class="cuisine-browser" hidden>
          <h2>Browse Recipes by Cuisine</h2>

          <details>
            <summary>Mexican</summary>
            <ul>
              <li data-slug="tacos">Tacos</li>
              <li data-slug="enchiladas">Enchiladas</li>
              <li data-slug="rice-and-beans">Rice & Beans</li>
            </ul>
          </details>

          <details>
            <summary>Italian</summary>
            <ul>
              <li data-slug="chicken-parmesan">Chicken Parmesan</li>
              <li data-slug="spaghetti-and-meatballs">Spaghetti & Meatballs</li>
              <li data-slug="baked-ziti">Baked Ziti</li>
            </ul>
          </details>
        </section>
        <div class="controls">
          <details class="control" id="allergenControl">
            <summary>Allergens</summary>
            <div class="control-body">
              <label><input type="checkbox" class="allergen-check" value="Gluten"> Gluten</label>
              <label><input type="checkbox" class="allergen-check" value="Dairy"> Dairy</label>
              <label><input type="checkbox" class="allergen-check" value="Eggs"> Eggs</label>
              <label><input type="checkbox" class="allergen-check" value="Peanuts"> Peanuts</label>
              <label><input type="checkbox" class="allergen-check" value="Tree Nuts"> Tree Nuts</label>
              <label><input type="checkbox" class="allergen-check" value="Soy"> Soy</label>
              <label><input type="checkbox" class="allergen-check" value="Shellfish"> Shellfish</label>
              <label><input type="checkbox" class="allergen-check" value="Fish"> Fish</label>
              <label><input type="checkbox" class="allergen-check" value="Sesame"> Sesame</label>
            </div>
          </details>
          <details class="control" id="dietaryControl">
            <summary>Dietary Restrictions</summary>
            <div class="control-body">
              <label><input type="checkbox" value="Vegetarian" class="dietary-check"> Vegetarian</label>
              <label><input type="checkbox" value="Vegan" class="dietary-check"> Vegan</label>
              <label><input type="checkbox" value="Gluten-Free" class="dietary-check"> Gluten-Free</label>
              <label><input type="checkbox" value="Dairy-Free" class="dietary-check"> Dairy-Free</label>
              <label><input type="checkbox" value="Nut-Free" class="dietary-check"> Nut-Free</label>
              <div class="chips" id="dietaryChips"></div>
            </div>
          </details>

          <details class="control" id="macrosControl">
            <summary>Macros</summary>
            <div class="control-body macros-grid">
              <label>Protein (g)<input type="number" id="proteinInput" min="0" value="30"></label>
              <label>Carbs (g)<input type="number" id="carbsInput" min="0" value="45"></label>
              <label>Fat (g)<input type="number" id="fatInput" min="0" value="12"></label>
              <div class="macro-summary" id="macroSummary">~384 kcal / serving</div>
            </div>
          </details>

          <details class="control" id="nutritionControl">
            <summary>Nutrition</summary>
            <div class="control-body metrics-grid">
              <label>Calories<input type="number" id="caloriesInput" min="0" value="420"></label>
              <label>Sodium (mg)<input type="number" id="sodiumInput" min="0" value="480"></label>
              <label>Sat. Fat (g)<input type="number" id="satFatInput" min="0" step="0.1" value="6"></label>
              <div class="metric-value" id="nutritionSummary">420 kcal · 480 mg sodium · 6 g sat fat</div>
            </div>
          </details>

          <details class="control" id="heatControl">
            <summary>Heat Scale</summary>
            <div class="control-body">
              <input type="range" id="heatSlider" min="0" max="10" value="3">
              <div class="heat-label" id="heatLabel">Mild (3/10)</div>
              <div class="heat-actions">
                <button type="button" id="heatAddBtn">Add spice boost</button>
              </div>
              <div class="heat-reco" id="heatReco">Try a pinch of black pepper and a squeeze of lemon for gentle warmth.</div>
            </div>
          </details>

          <details class="control" id="portionsControl">
            <summary>Portions</summary>
            <div class="control-body portions">
              <label>Servings<input type="number" id="portionInput" min="1" value="4"></label>
              <button id="portionApply" type="button">Scale ingredients</button>
            </div>
          </details>

          <details class="control" id="priceControl">
            <summary>Price</summary>
            <div class="control-body price-grid">
              <label>Price / serving<input type="number" id="pricePerServing" min="0" step="0.01" value="4.50"></label>
              <label>Currency
                <select id="currencySelect">
                  <option value="USD" selected>USD</option>
                  <option value="EUR">EUR</option>
                  <option value="GBP">GBP</option>
                </select>
              </label>
              <div class="metric-value" id="priceSummary">$18.00 total</div>
            </div>
          </details>

          <details class="control" id="difficultyControl">
            <summary>Difficulty</summary>
            <div class="control-body difficulty-row">
              <select id="difficultySelect">
                <option value="Easy" selected>Easy</option>
                <option value="Medium">Medium</option>
                <option value="Hard">Hard</option>
              </select>
              <span class="badge" id="difficultyBadge">Easy</span>
            </div>
          </details>

          <details class="control" id="timeControl">
            <summary>Time</summary>
            <div class="control-body time-grid">
              <label>Prep (min)<input type="number" id="prepTime" min="0" value="15"></label>
              <label>Cook (min)<input type="number" id="cookTime" min="0" value="25"></label>
              <div class="metric-value" id="timeSummary">~40 min total</div>
            </div>
          </details>
        </div>
      </header>

      <details class="section" open>
        <summary>Method</summary>
        <div class="section-content">
          <p>Describe your cooking technique here. This is where you can introduce the philosophy or inspiration behind the dish.</p>
        </div>
      </details>

      <details class="section" open>
        <summary>Ingredients</summary>
        <div class="section-content">
          <ul id="ingredientsList">
            <li data-base-qty="1" data-unit="cup" data-name="rice"><span class="qty">1</span> <span class="unit">cup</span> <span class="name">rice</span></li>
            <li data-base-qty="2" data-unit="tbsp" data-name="soy sauce"><span class="qty">2</span> <span class="unit">tbsp</span> <span class="name">soy sauce</span></li>
            <li data-base-qty="0.5" data-unit="cup" data-name="chopped scallions"><span class="qty">0.5</span> <span class="unit">cup</span> <span class="name">chopped scallions</span></li>
          </ul>
        </div>
      </details>

      <details class="section" open>
        <summary>Execution</summary>
        <div class="section-content">
          <ol>
            <li>Step one goes here.</li>
            <li>Step two goes here.</li>
            <li>…</li>
          </ol>
        </div>
      </details>

      <details class="section">
        <summary>Notes & Variations</summary>
        <div class="section-content">
          <p>Add any personal notes, variations, or serving suggestions here.</p>
        </div>
      </details>
    </div>
  </div>
  <script type="module" src="components/main.js"></script>
  <footer id="buildStamp" style="padding:12px 16px; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, 'Liberation Mono', 'Courier New', monospace; font-size: 12px; opacity: 0.85;">
    Build stamp loading…
  </footer>
  <script>
    (function () {
      const build = window.__RECIPE_ENGINE_BUILD__ || {};
      const baseEl = document.querySelector('base');
      const baseHref = baseEl ? baseEl.getAttribute('href') : '(none)';
      const resolvedBase = baseEl ? baseEl.href : document.baseURI;
      const stamp = {
        entrypoint: build.entrypoint,
        sourceFile: build.sourceFile,
        repoCommit: build?.repo?.commit,
        parentCommit: build?.parentRepo?.commit,
        timestamp: new Date().toISOString(),
        baseHref,
        resolvedBase,
        location: window.location.href
      };

      const el = document.getElementById('buildStamp');
      if (el) {
        el.textContent = `ENTRY=${stamp.entrypoint} | FILE=${stamp.sourceFile} | nested@${stamp.repoCommit} root@${stamp.parentCommit} | time=${stamp.timestamp} | base=${stamp.baseHref} -> ${stamp.resolvedBase}`;
      }
      console.log('[recipe-engine build-stamp]', stamp);

      window.addEventListener(
        'error',
        (event) => {
          const target = event.target;
          if (!target) return;
          const tag = (target.tagName || '').toLowerCase();
          if (tag === 'script' || tag === 'link' || tag === 'img') {
            const url = target.src || target.href;
            if (url) console.error('[recipe-engine resource-error]', { tag, url });
          }
        },
        true
      );

      window.addEventListener('unhandledrejection', (event) => {
        console.error('[recipe-engine unhandledrejection]', event.reason);
      });

      window.addEventListener('error', (event) => {
        if (event?.message) console.error('[recipe-engine window-error]', event.message);
      });

      (async function assetSelfCheck() {
        const checks = [
          { name: 'CSS', url: 'assets/style.css' },
          { name: 'MainJS', url: 'components/main.js' },
          { name: 'RecipeList', url: 'recipes/list.json' }
        ];

        const results = [];
        for (const item of checks) {
          const bust = `__stamp=${encodeURIComponent(stamp.timestamp)}`;
          const url = item.url.includes('?') ? `${item.url}&${bust}` : `${item.url}?${bust}`;
          try {
            const res = await fetch(url, { cache: 'no-store' });
            results.push({ name: item.name, url: res.url, ok: res.ok, status: res.status });
          } catch (err) {
            results.push({ name: item.name, url, ok: false, status: 'fetch-failed', error: String(err) });
          }
        }

        const loadedStyles = Array.from(document.styleSheets || [])
          .map((s) => s.href)
          .filter(Boolean);

        console.log('[recipe-engine asset-self-check]', { results, loadedStyles });
        const anyBad = results.some((r) => r.ok !== true);
        if (anyBad) console.error('[recipe-engine asset-self-check] FAIL', results);
      })();
    })();
  </script>
</body>
</html>
